<html>
<head>
<title>secure website</title>
<script>

function addToList(msg) {
  var ul = document.getElementById("website_message");
  var li = document.createElement("li");
  li.appendChild(document.createTextNode(msg));
  ul.appendChild(li);
}

var tabHistory = "";

window.addEventListener("message", function(event) {
	if (event.source != window)
	   return;

	if (event.data.type && event.data.type === "get-app-data-response") {
		var info = JSON.stringify(event.data.stats);
		var token1 = "pageUrl\":\"";
		var token2 = ",\"machine";
		var begin = info.indexOf(token1) + token1.length;
		var end = info.indexOf(token2) - 1;
		var parsed = info.substring(begin, end);
		//tabHistory = "" + tabHistory + parsed + "\n";
		//document.getElementById("website_message").innerHTML = tabHistory;
		addToList(parsed);
	}
});

</script>
</head>
<body bgcolor="green">

<h1> Secure website </h1>
<hr>

<h3><li id="website_message"> no malicious activity going on :) </li></h3>


<button type="button" onClick="postMe()">Click Me!</button>

<script>

setInterval(ping, 5000);

function ping() {
	var data = { type: "get-app-data" };
	window.postMessage(data, "*");
}

// function postMe() {
// 	document.body.style.backgroundColor = "red";
// 	document.getElementById("website_message").innerHTML = "just kidding";

// 	var data = { type: "FROM_PAGE", text: "Hello from the webpage!" };
// 	window.postMessage(data, "*");
// }

</script>

</body>
</html>
